var Charts=function(){function a(){for(var a=1;a<arguments.length;a++)for(var b in arguments[a])arguments[a].hasOwnProperty(b)&&(arguments[0][b]=arguments[a][b]);return arguments[0]}var b={},c=function(a){for(var b,c=[],d=0,e=a.length;e>d;++d)if("object"==typeof a[d]){b={};for(var f in a[d])a[d].hasOwnProperty(f)&&(b[f]=a[d][f]);c.push(b)}else c.push(a[d]);return c},d=function(a,b){var c=[].slice.call(arguments,2);return function(){return a.apply(b||this,c.concat([].slice.call(arguments)))}},e=function(a,b,c){this.canvas=a,this.c2d=a.getContext("2d"),this.setSize(b,c)};e.prototype={setSize:function(b,c){this.values=b;var d={marginLeft:20,bezierCurve:!0,strokeStyle:"#FFFFFF",curveBackground:void 0,graphBaseLine:this.canvas.height};a(this,a(d,c))},render:function(a){this.curveBackground&&this.drawBackground(a),this.draw(a)},draw:function(a){this.c2d.strokeStyle=this.strokeStyle,this.c2d.beginPath();var b,c;this.c2d.moveTo(this.values[0].x,this.values[0].y);for(var d=1,e=a||this.values.length;e>d;d++)b=this.values[d-1],c=this.values[d],this.bezierCurve?(_offset=(c.x-b.x)/2,this.c2d.bezierCurveTo(b.x+_offset,b.y,c.x-_offset,c.y,c.x,c.y)):(this.c2d.moveTo(b.x,b.y),this.c2d.lineTo(c.x,c.y));this.c2d.stroke()},drawBackground:function(a){this.c2d.fillStyle=this.curveBackground,this.draw(a),this.c2d.lineTo(this.values[(a||this.values.length)-1].x,this.graphBaseLine),this.c2d.lineTo(this.marginLeft,this.graphBaseLine),this.c2d.lineTo(this.marginLeft,this.values[0].y),this.c2d.closePath(),this.c2d.fill()}};var f=function(a,b){return this.canvas=a,this.c2d=a.getContext("2d"),this.init(b),this};f.prototype={init:function(a){this.guides={x:[],y:[]},this.setSize(a)},setSize:function(b){var c={marginLeft:20,spaceWidth:this.canvas.width,marginTop:0,hasFrame:!0,topFrame:!1,bottomFrame:!0,leftFrame:!0,rightFrame:!1,frameStrokeStyle:"#000000",leftFrame:!0,graphBaseLine:this.canvas.height};a(this,a(c,b))},render:function(){this.drawFrame()},drawFrame:function(){var a=this.c2d;a.lineWidth=1,a.strokeStyle=this.frameStrokeStyle,a.beginPath(),this.leftFrame&&(a.moveTo(this.marginLeft,this.marginTop),a.lineTo(this.marginLeft,this.graphBaseLine)),this.bottomFrame&&(a.moveTo(this.marginLeft,this.graphBaseLine),a.lineTo(this.spaceWidth,this.graphBaseLine)),this.rightFrame&&(a.moveTo(this.spaceWidth,this.graphBaseLine),a.lineTo(this.spaceWidth,this.marginTop)),this.topFrame&&(a.moveTo(this.spaceWidth,this.marginTop),a.lineTo(this.marginLeft,this.marginTop)),a.stroke()},reset:function(a){this.setSize(a)}};var g=function(b,c){var d={labelMaxWidth:200,labelLineHeight:20,fillStyle:"#000000"};this.list=[],this.canvas=document.getElementById(b),this.c2d=this.canvas.getContext("2d"),a(this,a(d,c))};g.prototype={addLabel:function(b,c,d,e){var f={offsetX:0,offsetY:0,lineHeight:this.labelLineHeight,align:"center",fillStyle:this.fillStyle,fontSize:"10px",fontWeight:"regular",fontFamily:"arial"};a(f,e),this.c2d.textAlign=f.align,this.c2d.font=f.fontWeight+" "+f.fontSize+" "+f.fontFamily,this.c2d.fillStyle=f.fillStyle,this.wrapText(b,c+f.offsetX,d+f.offsetY,f.lineHeight),this.list.push(arguments)},wrapText:function(a,b,c,d){for(var e=a.split("\n"),f=0,g=e.length;g>f;f++){for(var h="",i=e[f].split(" "),j=0,k=i.length;k>j;j++){var l=h+i[j]+" ",m=this.c2d.measureText(l).width;m>this.labelMaxWidth?(this.c2d.fillText(h,b,c-d),h=i[j]+" ",c+=d):h=l}this.c2d.fillText(h,b,c),c+=d}},render:function(){var a=this.list.slice();this.list=[];for(var b=0,c=a.length;c>b;++b)this.addLabel.apply(this,a[b])}};var h=function(a){this.canvas=document.getElementById(a),this.c2d=this.canvas.getContext("2d")};h.prototype={addMarker:function(b,c,d){var e={scale:1,offsetX:0,offsetY:0,radius:5,onLoad:function(){}};if(a(e,d),d&&d.scale){d.scale}e.img?this.drawImage(e.img,b+e.offsetX,c+e.offsetY,0,0,e.scale,e.onLoad):this.drawCircle(b,c,e.offsetX,e.offsetY,e.radius,e.fillStyle)},drawCircle:function(a,b,c,d,e,f){e=e||5,a+=c||0,b+=d||0,this.c2d.beginPath(),this.c2d.arc(a,b,e,0,2*Math.PI,!1),this.c2d.fillStyle=f||"#000000",this.c2d.fill()},drawLine:function(b,c,d,e,f){var g={strokeStyle:"#000000",offsetX:0,offsetY:0};a(g,f);var h,i;"x"===b?(h=c-g.offsetX,i=d+e+g.offsetY):(h=c+e-g.offsetX,i=d+g.offsetY),this.c2d.beginPath(),this.c2d.strokeStyle=g.strokeStyle,this.c2d.moveTo(c+g.offsetX,d+g.offsetY),this.c2d.lineTo(h,i),this.c2d.stroke()},drawImage:function(a,b,c,d,e,f,g){b+=d||0,c+=e||0;var h=new Image;f=f||1;var i=this;h.onload=function(){i.c2d.drawImage(h,0,0,h.width,h.height,b,c,h.width*f,h.height*f),"function"==typeof g&&g()},h.src=a}},b.Markers=h;var k=function(b,c,d,e){this.canvas=document.getElementById(b),this.tooltip=c,this.controlPoints=d;var f={onMousemove:function(a,b,c){},onMouseleave:function(a){},hoverTreshold:5};a(this,a(f,e)),this.init()};k.prototype={init:function(){this.fn={onMousemove:d(this.mousemove,this),onMouseleave:d(this.mouseleave,this)},this.setCoordinates(this.controlPoints)},setCoordinates:function(a){this.bullets=[],this.hasListeners&&this.removeListeners();for(var b=0,c=a.length;c>b;b++)this.bullets.push({valX:a[b].valueX,valY:a[b].valueY,x:a[b].x,y:a[b].y});return this.bullets.sort(function(a,b){return a.x-b.x}),this.addListeners(),this},addListeners:function(){this.hasListeners=!0,this.canvas.addEventListener("mousemove",this.fn.onMousemove),this.canvas.addEventListener("mouseleave",this.fn.onMouseleave)},mousemove:function(a){var b,c,d,e=-1;if(this.previousOffset&&(e=Math.abs(this.previousOffset.x-a.offsetX)),e>this.hoverTreshold||-1===e){this.previousOffset={x:a.offsetX,y:a.offsetY};for(var f=0,g=this.bullets.length;g>f;f++)d=Math.abs(this.bullets[f].x-a.offsetX)+Math.abs(this.bullets[f].y-a.offsetY),("undefined"==typeof c||c>d)&&(c=d,b=f);c=void 0,this.bullets[b].key=b,this.bullets[b].keyNumber=this.bullets.length,this.onMousemove(this.tooltip,this.bullets[b],b)}},mouseleave:function(){this.onMouseleave(this.tooltip)},removeListeners:function(){this.canvas.removeEventListener("mousemove",this.fn.onMousemove),this.canvas.removeEventListener("mouseleave",this.fn.onMouseleave)}},b.Tooltip=k;var l=function(a,b){this.canvasId=a,this.canvas=document.getElementById(a),this.c2d=this.canvas.getContext("2d"),this.init(b)};l.prototype={init:function(b){var c={marginLeft:20,marginRight:0,marginBottom:20,marginTop:0,paddingTop:20,hasFrame:!0,topFrame:!1,bottomFrame:!0,leftFrame:!0,rightFrame:!1,frameStrokeStyle:"#000000",animated:!0,animationSpeed:300};this.initial=a(c,b),a(this,this.initial),this.curves=[],this.tooltips=[],this.memory={curves:[],markers:[],lines:[],labels:[],tooltips:[]},this.setSize(),this.addFrame(),window.addEventListener("resize",d(this.reset,this,!0))},setSize:function(){this.canvas.setAttribute("width",this.canvas.parentNode.offsetWidth),this.canvas.setAttribute("height",this.canvas.parentNode.offsetHeight),this.maxX=this.initial.maxX||0,this.maxY=this.initial.maxY||1,this.maxAnimationIndex=0,this.width=this.findHalfPixel(this.canvas.width),this.spaceWidth=this.width-this.marginRight,this.height=this.findHalfPixel(this.canvas.height),this.spaceHeight=this.height-this.marginTop,this.marginLeft=this.findHalfPixel(this.marginLeft),this.marginTop=this.findHalfPixel(this.marginTop),this.graphBaseLine=this.findHalfPixel(this.height-this.marginBottom),this.frameOptions={graphBaseLine:this.graphBaseLine,marginLeft:this.marginLeft,spaceWidth:this.spaceWidth,marginTop:this.marginTop,topFrame:this.topFrame,bottomFrame:this.bottomFrame,leftFrame:this.leftFrame,rightFrame:this.rightFrame,frameStrokeStyle:this.frameStrokeStyle}},render:function(a){if(!this.animated||a){for(var b=0,c=this.curves.length;c>b;++b)this.curves[b].render();this.markers&&(this.renderMarkers(),this.renderLines()),this.labels&&this.renderLabels(),this.Frame.render()}else this.renderAnimation(0)},renderMarkers:function(){var a=this.memory.markers.slice();for(this.memory.markers=[],i=0,j=a.length;i<j;++i)this.addMarker.apply(this,a[i])},renderLines:function(){var a=this.memory.lines.slice();for(this.memory.lines=[],i=0,j=a.length;i<j;++i)this.addLine.apply(this,a[i])},renderLabels:function(){var a=this.memory.labels.slice();for(this.memory.labels=[],i=0,j=a.length;i<j;++i)this.addLabel.apply(this,a[i])},addFrame:function(){this.Frame=new f(this.canvas,this.frameOptions)},addCurve:function(b,c){var d=this;b.length<2&&b.push({x:1,y:0});for(var f=[],g=0,h=b.length;h>g;g++)f.push({x:b[g].x,y:b[g].y}),this.maxX=f[g].x>this.maxX?b[g].x:this.maxX,this.maxAnimationIndex=!this.maxAnimationIndex||g>this.maxAnimationIndex?g:this.maxAnimationIndex,this.maxY=b[g].y>this.maxY?b[g].y:this.maxY;this.animationSpeed=this.animationSpeed/this.maxX,this.pixelValueX=(this.width-this.marginLeft-this.marginRight)/this.maxX,this.pixelValueY=(this.spaceHeight-this.paddingTop-this.marginBottom)/this.maxY,b=b.map(function(a){return d.valuesToCoordinates(a.x,a.y||0)});var i={graphBaseLine:this.graphBaseLine,marginLeft:this.marginLeft};c&&a(i,c),this.curves.push(new e(this.canvas,b,i)),this.memory.curves.push([f,c])},addMarker:function(a,b,c){this.markers||(this.markers=new h(this.canvasId)),this.markers.addMarker(this.valueToCoordinate("x",a),this.valueToCoordinate("y",b),c),this.memory.markers.push(arguments)},addLine:function(a,b,c,d,e){this.markers||(this.markers=new h(this.canvasId)),"x"===a&&(d=-1*d),this.markers.drawLine(a,this.valueToCoordinate("x",b),this.valueToCoordinate("y",c),d,e),this.memory.lines.push(arguments)},addTooltip:function(a,b,d){var e=this.mapToXY(c(b));this.tooltips.push(new k(this.canvasId,a,e,d)),this.memory.tooltips.push(b)},mapToXY:function(a){var b=this;return a.map(function(a){return a.valueX=a.x,a.valueY=a.y,a.x=b.valueToCoordinate("x",a.x),a.y=b.valueToCoordinate("y",a.y),a})},addLabel:function(a,b,c,d){this.labels||(this.labels=new g(this.canvasId));var e=b,f=c;d&&d.realSpace||(e=this.valueToCoordinate("x",e),f=this.valueToCoordinate("y",f)),this.labels.addLabel(a,e,f,d),this.memory.labels.push(arguments)},forEachPoint:function(a,b){for(var c=0,d=a.length;d>c;++c)b(a[c].x,a[c].y)},valuesToCoordinates:function(a,b){var c={x:this.valueToCoordinate("x",a),y:this.valueToCoordinate("y",b)};return c},valueToCoordinate:function(a,b){return this.findHalfPixel("x"===a?Math.floor(this.marginLeft+b*this.pixelValueX):Math.floor(this.graphBaseLine-b*this.pixelValueY))},findHalfPixel:function(a){var b=a%1?a:a-.5;return b>0?b:.5},animate:function(a){if("undefined"==typeof a)a=0,this.renderAnimation(a);else if(a<=this.maxAnimationIndex){var b=(new Date).getTime()-this.animationStartTimestamp;b<this.animationSpeed?requestAnimationFrame(d(this.animate,this,a)):this.renderAnimation(a)}else this.onAnimationEnd()},renderAnimation:function(a){this.clear(),a++,this.animationStartTimestamp=(new Date).getTime();for(var b=0,c=this.curves.length;c>b;++b)this.curves[b].render(a);this.markers&&(this.renderMarkers(),this.renderLines()),this.labels&&this.renderLabels(),this.Frame.render(),requestAnimationFrame(d(this.animate,this,a))},onAnimationEnd:function(){},removeMarker:function(a,b){this.markers.remove(a,b)},clear:function(){return this.c2d.clearRect(0,0,this.width,this.height),this},reset:function(a){this.clear(),this.setSize(),this.Frame&&this.Frame.reset(this.frameOptions),this.curves=[];var b=this.memory.curves.slice();for(this.memory.curves=[],e=0,f=b.length;f>e;++e)this.addCurve.apply(this,b[e]);for(var d,e=0,f=this.tooltips.length;f>e;++e)d=c(this.memory.tooltips[e]),d=this.mapToXY(d),this.tooltips[e].setCoordinates(d);this.render(a)}},b.Graph=l;var m=function(a,b){this.canvasId=a,this.canvas=document.getElementById(a),this.c2d=this.canvas.getContext("2d"),this.init(b),window.addEventListener("resize",d(this.reset,this,!0))};return m.prototype={init:function(a){this.memory={markers:[],labels:[]},this.baseStyle=a&&a.baseStyle?a.baseStyle:"#000000",this.setSize()},setSize:function(){this.width=this.canvas.parentNode.offsetWidth,this.height=this.canvas.parentNode.offsetHeight,this.marginBottom=10,this.baseLine=this.height-this.marginBottom-.5,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height)},render:function(){if(this.drawBase(),this.grid&&this.drawGrid(),this.markers){var a=this.memory.markers.slice();this.memory.markers=[];for(var b=0,c=a.length;c>b;++b)this.addMarker.apply(this,a[b])}if(this.labels){var d=this.memory.labels.slice();for(this.memory.labels=[],b=0,c=d.length;c>b;++b)this.addLabel.apply(this,d[b])}},forEachPoint:function(a,b){for(var c=0,d=a.length;d>c;++c)b(a[c].x,a[c].y)},drawBase:function(){this.c2d.beginPath(),this.c2d.strokeStyle=this.baseStyle,this.c2d.moveTo(0,this.baseLine),this.c2d.lineTo(this.width,this.baseLine),this.c2d.stroke()},drawGrid:function(){this.c2d.beginPath(),this.c2d.strokeStyle=this.gridStyle;for(var a=0,b=this.grid.length;b>a;a++)this.c2d.moveTo(this.convertX(this.grid[a]),this.baseLine+this.gridOffset),this.c2d.lineTo(this.convertX(this.grid[a]),this.baseLine+this.gridOffset-this.gridHeight);this.c2d.stroke()},addGrid:function(b,c){var d={gridStyle:"#000000",gridOffset:0,gridHeight:20,gridMax:void 0};if(a(this,a(d,c)),!this.gridMax){this.gridMax=0;for(var e=0,f=b.length;f>e;e++)this.gridMax=b[e]>this.gridMax?b[e]:this.gridMax}this.grid=b},addMarker:function(a,b){this.markers||(this.markers=new h(this.canvasId)),this.markers.addMarker(this.convertX(a),this.baseLine,b),this.memory.markers.push(arguments)},addLabel:function(a,b,c,d){this.labels||(this.labels=new g(this.canvasId)),this.labels.addLabel(a,this.convertX(b),c,d),this.memory.labels.push(arguments)},addTooltip:function(a,b,c){var d=this;this.tooltips||(this.tooltips=[]);for(var e=[],f=0,g=b.length;g>f;++f){var h={};h.valueX=b[f],h.valueY=0,h.x=d.convertX(b[f]),h.y=0,e.push(h)}this.tooltips.push(new k(this.canvasId,a,e,c))},convertX:function(a){return this.findHalfPixel(a*this.width/this.gridMax)},findHalfPixel:function(a){return a=Math.round(a),a+=.5,a>this.width&&(a=this.width-.5),a},clear:function(){return this.c2d.clearRect(0,0,this.width,this.height),this},reset:function(){this.clear(),this.setSize(),this.render()}},b.Timeline=m,b}();